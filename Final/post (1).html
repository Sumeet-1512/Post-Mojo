
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Forum - Post</title>

    <style type="text/css">
      .author-col {
        min-width: 12em;
      }
      .post-col {
        min-width: 20em;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container">
        <h1><a href="/postMojo" class="navbar-brand">PostMOJO</a></h1>
        <form class="form-inline">
          <input type="text" class="form-control mr-3 mb-2 mb-sm-0" placeholder="Search">
          <button type="submit" class="btn btn-primary">Search</button>
        </form>
      </div>
    </nav>
    <div class="container my-3">
      <nav class="breadcrumb">
        <a href="/postMojo" class="breadcrumb-item">Board index</a>
        
    <a href="/Postit" type="submit" class="btn btn-primary" style="margin-left: 60%" >Create forum</a>
    <a type="submit" class="text-white btn btn-dark">OnlineChatRoom</a>
      </nav>
      <div class="row">
        <div class="col-12">
          <h1 class="h1 text-white bg-primary mb-0 p-4 rounded-top" id = "mainforumname"></h1>

          <h5 class="h4 text-black bg-light mb-0 p-4 rounded-top" id = "forumdescription"></h5>
          <h3 class="h4 text-white bg-secondary mb-0 p-4 rounded-top" id = "forumauthor"></h3>

          <table class="table table-striped table-bordered table-responsive-lg">
            <tbody id ="replyblock">
            </tbody>
          </table>
        </div>
      </div>
      <form class="mb-3">
        <div class="form-group">
          <label for="autho">Author:</label>
          <input required type="text" required class="form-control" id="replyauthor" rows="1" placeholder="Write anonymous name." >
        
          <label for="title">Title:</label>
          <input required type="text" required class="form-control" id="replytitle" rows="1" placeholder="Write title of your reply" >

          <label for="description">Description:</label>
          <textarea required type="text" required class="form-control" id="reply" rows="6" placeholder="Write description of your reply" ></textarea>
        </div>
        <button type="button" class="btn btn-primary" id = "replybutton">Reply</button>
        <button type="reset" class="btn btn-danger">Reset</button>
      </form>
    </div>
    <footer class="small bg-dark text-white">
      <div class="container py-4">
        <ul class="list-inline mb-0 text-center">
          <li class="list-inline-item"> 2017 Web Company, Inc.</li>
          <li class="list-inline-item">All rights reserved.</li>
          <li class="list-inline-item"><a href="#">Terms of use and privacy policy</a>.</li>
        </ul>
      </div>
    </footer>
    <!-- jQuery first, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.1.0/firebase-database.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyBACola5JwsYE2O2_LbW1-cxGLUTFeQTPk",
    authDomain: "mwdm-85dc5.firebaseapp.com",
    databaseURL: "https://mwdm-85dc5.firebaseio.com",
    projectId: "mwdm-85dc5",
    storageBucket: "",
    messagingSenderId: "131924353033",
    appId: "1:131924353033:web:a8a3efb86201f4393bd8d8"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
</script>   

<script >
var str = window.location.href
mySubString = str.split('&')
var topicload = mySubString[0].split('=')
var usernameload = mySubString[1].split('=')
var descriptionload = mySubString[2].split('=')
var category = mySubString[3].split('=')
console.log(mySubString)
console.log("this is the category of the current page : "+category[1])
var postpagecategory =category[1]

var topicloadspace = topicload[1]
var usernameloadspace = usernameload[1]
var descriptionloadspace = descriptionload[1]
// http://localhost:3000/post?query=fsdfs
var topic = topicloadspace.split('%20')
var username = usernameloadspace.split('%20')
var description = descriptionloadspace.split('%20')
console.log(topic.length)
var count1=0
var count2=0
var count3=0
var endtopic=""
var endusername=""
var enddescription=""
while(count1<topic.length){
  endtopic = endtopic+" "+topic[count1] 
  count1= count1+1
}
while(count2<username.length){
  endusername = endusername +" "+username[count2]
  count2= count2+1
}
while(count3<description.length){
  enddescription = enddescription +" "+description[count3]
  count3= count3+1
}
console.log(endtopic+" "+endusername+" "+enddescription)
$('#mainforumname').append("Topic : "+endtopic);
$('#forumdescription').append("Description : "+enddescription)
$('#forumauthor').append("Author :"+endusername)


if (!firebase.auth().currentUser ) {
  $('#idgooglesign').html("Login");
}else if(firebase.auth().currentUser ){
 $('#idgooglesign').html("Logout");
}
function toggleSignIn(checker) {
      if (!firebase.auth().currentUser) {
         // Sign into Firebase using popup auth & Google as the identity provider.
   base_provider = new firebase.auth.GoogleAuthProvider()
  firebase.auth().signInWithPopup(base_provider).then(function(result){
    
    var username = result.user.displayName
    var useremail = result.user.email
    var phoneno = result.user.phoneNumber
    var profilepic = result.user.photoURL
    var userdata = [username,useremail,phoneno,profilepic]
    console.log(userdata)
    console.log("Successfully Loggedin...")
    $('#idgooglesign').html("Logout");
  }).catch(function(err){
    console.log(err)
  });
      } else {
        // [START signout]
        firebase.auth().signOut();
        $('#idgooglesign').html("Login");

        
        // [END signout]
      }
    }

var replybutton = document.getElementById("replybutton")
replybutton.onclick=()=>{
  window.alert("Reply is getting posted. . .");
    var authorname = document.getElementById("replyauthor").value;
    var title = document.getElementById("replytitle").value;
    var description = document.getElementById("reply").value;
    var d = Date(Date.now()); 
    date = d.toString() 

    console.log(endtopic+" ")
    console.log(authorname+" "+title+" "+description+" "+date)
      console.log(postpagecategory)
      
     document.getElementById("replyauthor").value="";
    document.getElementById("replytitle").value="";
     document.getElementById("reply").value="";

      var categoryref = firebase.database().ref(postpagecategory)
      var keyle= categoryref.push().key;
        
        var data = {
          date:date,
          topic:endtopic,
          authorname : authorname,
          title: title,
          description : description,
          category : postpagecategory
        }
      var updates ={};
      updates['/'+postpagecategory+'/'+'reply'+'/'+keyle+'/']=data;
      firebase.database().ref().update(updates);
      alert("post has been created.");


} 
  
var fireheadref = firebase.database().ref(postpagecategory+'/reply')
console.log(endtopic)
fireheadref.on('child_added',function(datasnapshot){
    
    var authorname = datasnapshot.child("authorname").val();
    
    var category = datasnapshot.child("category").val();

    var description = datasnapshot.child("description").val();
    
    var title = datasnapshot.child("title").val();
    
    var topic = datasnapshot.child("topic").val();
    
    var queryinfo = [authorname,category,description,title,topic]
    console.log(endtopic)
    console.log(queryinfo)
    if(endtopic == topic){
    var content =""
content+='<tr>'
content+='<td class="author-col"  >'
content+='<div>Reply Author : <span id="authorname">'+authorname+'</span></div>'
content+='</td>'
content+='<td>Reply</td>'
content+='<td class="post-col d-lg-flex justify-content-lg-between">'
content+='<div ><span class="font-weight-bold">Reply subject : </span><span id = "replysubject">'+title+'</span></div>'
content+='</td>'
content+='</tr>'
content+='<tr>'
content+='<td>'

content+='</td>'
content+='<td style="width:100%" colspan="2">'
content+='<p id ="replydescription"  >'+description+'<p/>'
content+='</td>'
content+='</tr>'
          $('#replyblock').append(content)
}else{
  console.log('Server gone bad')
}

})

    //         $('#movie').append(content)
    
    // console.log(username+category+query+query2)
   



</script>
    <!-- jQuery first, then Bootstrap JS -->
    </body>
</html>